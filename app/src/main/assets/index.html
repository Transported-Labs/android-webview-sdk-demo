<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <style>
            .button { position: relative; width: 150px; height: 34px; font-size: 16px;}
            .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
            .switch input { opacity: 0; width: 0; height: 0; }
            label.switch { outline: none; }
            .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; -webkit-transition: .4s; transition: .4s; outline: none; }
            .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; -webkit-transition: .4s; transition: .4s; }
            input:checked + .slider { background-color: #2196F3; }
            input:focus + .slider { box-shadow: 0 0 1px #2196F3; }
            input:checked + .slider:before { -webkit-transform: translateX(26px); -ms-transform: translateX(26px); transform: translateX(26px); }
            .slider.round { border-radius: 34px; }
            .slider.round:before { border-radius: 50%; }
        </style>
    </head>
    <body>
        <h2 id="value">Toggle Torch using switch below</h2>
        <label class="switch">
            <input type="checkbox" name="torchCheckbox">
            <span class="slider round"></span>
        </label>
        <h3></h3>
        <button class="button" name="torchStateButton">Check state</button>
        <h3></h3>
        <button class="button" name="vibrateButton">Vibrate</button>
        <h3></h3>
        <button class="button" name="sparkleButton">Sparkle</button>
        <h3></h3>
        <button class="button" name="testErrorButton">Test error</button>
        <h3></h3>
        <div id="methodResult"></div>
        <h3></h3>
        <button class="button" name="micButton">Microphone</button>
        <h3></h3>
        <audio id="player" controls></audio>
        <script>
            const requestId = 323412;
            const torchServiceName = "torch";
            const vibrationServiceName = "vibration";
            
            //JSON is passed from app like that:
            //cueSDKCallback(JSON.stringify({
            //}))
            function cueSDKCallback(data) {
                //Process data as JSON object, e.g.
                //var transferData = JSON.parse(data);
                document.getElementById('methodResult').innerText = "Returned JSON: " + data.toString();
            }
            
            function callTorchMethod(method) {
                // Call in iOS WKWebView
                if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.cueSDK) {
                    window.webkit.messageHandlers.cueSDK.postMessage(JSON.stringify([requestId, torchServiceName, method]));
                }
                // Call in Android WebView
                if (cueSDK) {
                    cueSDK.postMessage(JSON.stringify([requestId, torchServiceName, method]));
                }
            }
            function callMethodWithDuration(service, method, duration) {
                if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.cueSDK) {
                    window.webkit.messageHandlers.cueSDK.postMessage(JSON.stringify([requestId, service, method, duration]));
                }
                // Call in Android WebView
                if (cueSDK) {
                    cueSDK.postMessage(JSON.stringify([requestId, service, method, duration]));
                }
            }
            
            function initMicrophone() {
                player = document.getElementById('player');
                navigator.mediaDevices
                    .getUserMedia({audio: true, video: false})
                    .then((stream) => {
                        player.srcObject = stream;
                        player.autoplay = true;
                    })
                .catch((err) => {
                    alert(`You got an error: ${err}`);
                });
            }

            var _selector = document.querySelector('input[name=torchCheckbox]');
            _selector.addEventListener('change', function(event) {
                var method = (_selector.checked) ? "on" : "off";
                callTorchMethod(method);
            });
            var _torchStateButton = document.querySelector('button[name=torchStateButton]');
            _torchStateButton.addEventListener('click', function(event) {
                callTorchMethod("isOn");
            });
            var _vibrateButton = document.querySelector('button[name=vibrateButton]');
            _vibrateButton.addEventListener('click', function(event) {
                callMethodWithDuration(vibrationServiceName, "vibrate", 500);
            });
            var _sparkleButton = document.querySelector('button[name=sparkleButton]');
            _sparkleButton.addEventListener('click', function(event) {
                callMethodWithDuration(torchServiceName, "sparkle", 5000);
            });
            var _micButton = document.querySelector('button[name=micButton]');
            _micButton.addEventListener('click', function(event) {
                initMicrophone();
            });
            var _testErrorButton = document.querySelector('button[name=testErrorButton]');
            _testErrorButton.addEventListener('click', function(event) {
                callTorchMethod("testError");
            });
        </script>
    </body>
</html>
